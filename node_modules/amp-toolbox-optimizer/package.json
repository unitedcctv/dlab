{
  "_args": [
    [
      {
        "raw": "amp-toolbox-optimizer@0.5.2-beta.6",
        "scope": null,
        "escapedName": "amp-toolbox-optimizer",
        "name": "amp-toolbox-optimizer",
        "rawSpec": "0.5.2-beta.6",
        "spec": "0.5.2-beta.6",
        "type": "version"
      },
      "/home/house/projects/node_modules/next-server"
    ]
  ],
  "_from": "amp-toolbox-optimizer@0.5.2-beta.6",
  "_hasShrinkwrap": false,
  "_id": "amp-toolbox-optimizer@0.5.2-beta.6",
  "_inCache": true,
  "_location": "/amp-toolbox-optimizer",
  "_nodeVersion": "10.11.0",
  "_npmOperationalInternal": {
    "host": "s3://npm-registry-packages",
    "tmp": "tmp/amp-toolbox-optimizer_0.5.2-beta.6_1554378222684_0.7290144279103641"
  },
  "_npmUser": {
    "name": "amp-toolbox",
    "email": "amp-toolbox-eng@google.com"
  },
  "_npmVersion": "lerna/3.13.1/node@v10.11.0+x64 (darwin)",
  "_phantomChildren": {},
  "_requested": {
    "raw": "amp-toolbox-optimizer@0.5.2-beta.6",
    "scope": null,
    "escapedName": "amp-toolbox-optimizer",
    "name": "amp-toolbox-optimizer",
    "rawSpec": "0.5.2-beta.6",
    "spec": "0.5.2-beta.6",
    "type": "version"
  },
  "_requiredBy": [
    "/next-server"
  ],
  "_resolved": "https://registry.npmjs.org/amp-toolbox-optimizer/-/amp-toolbox-optimizer-0.5.2-beta.6.tgz",
  "_shasum": "3f8ac38403bcae71b590d3f2579b0617689dbe56",
  "_shrinkwrap": null,
  "_spec": "amp-toolbox-optimizer@0.5.2-beta.6",
  "_where": "/home/house/projects/node_modules/next-server",
  "author": {
    "name": "AMPHTML Team"
  },
  "bugs": {
    "url": "https://github.com/ampproject/amp-toolbox/issues"
  },
  "dependencies": {
    "amp-toolbox-core": "^0.1.5",
    "amp-toolbox-runtime-version": "^0.2.6",
    "css": "^2.2.4",
    "parse5": "^5.1.0",
    "parse5-htmlparser2-tree-adapter": "^5.1.0"
  },
  "description": "Server-side rendering for AMPs.",
  "devDependencies": {
    "jimp": "0.6.0",
    "lru-cache": "^5.1.1"
  },
  "directories": {},
  "dist": {
    "integrity": "sha512-Dtuq3W+cTludZcNbGEecIfKsq55YqlLuJ9eCr6HaMjwm8pJlsXnjDcYgQVqsbF4R5KLjsr/AywX3xYTi2ni8lQ==",
    "shasum": "3f8ac38403bcae71b590d3f2579b0617689dbe56",
    "tarball": "https://registry.npmjs.org/amp-toolbox-optimizer/-/amp-toolbox-optimizer-0.5.2-beta.6.tgz",
    "fileCount": 24,
    "unpackedSize": 94776,
    "npm-signature": "-----BEGIN PGP SIGNATURE-----\r\nVersion: OpenPGP.js v3.0.4\r\nComment: https://openpgpjs.org\r\n\r\nwsFcBAEBCAAQBQJcpe3vCRA9TVsSAnZWagAABMMQAIjyrkf7PhAkPP6f4X2e\nvLhoe46LH/Ko4qQ+EvFsEsSfrMXJ0dk2mJX/KvjEyBvSiLBBi64r35NTKARc\nq0dG5Xg6PxgyZ1I73PCUgoZIZXVI5WfkQJX1xCoKvtHTsSiEc3Py86567DqR\nme7hqz3+1VcHmvEVuHAp++o621xehFTT8fQEEiMNPrrjZ69Sgt1H6ZY+o3Ra\nQW6SQ6AtBlyC01BPimNjWE4ToKRAvq3GHNy+BRWuPrHXbFPaCizNu9tLwUyW\nbrKwJX83G975EcEofabybGAPn/6wAGE+nCdyUOXFjWEf05vNs7JyjAl4zB2b\nx15XhCMyrbGOJOxLUdsQ//UPvIMyHKPyoVY4qhjxZ7SKVPY0e2lCyJu/rAzc\nUnxv/3bqKaoaHJjgcuf9aeIxRy3woso5XoYKNZx6Wa8iQOCqKGsAMJt5dMLf\n562wO3/J6eRtf3jHh36PxGi+Zjs4zCGDpRLWJU7vtoIdQOSZGi/n56J/hYh/\nBNsyD3wxM6tMYU83Vjw+IUajAczJTzdWYsPg/YpdLlhnGmz1rJDlBeZ/NSas\n4gV4xWVpPN5uGhG25dLeX4NSfM1Gvx1Ee80HFIgLhcq3zciHkkSynmE9u2hV\nwYKvbqevs+zoA3erC/YRJyym968OcYxFKDkSmr+7E//0wpmbkMBP85RzzWxZ\nVoL+\r\n=nHFz\r\n-----END PGP SIGNATURE-----\r\n"
  },
  "gitHead": "a490384f040ede1eb569c807cbfab286eba77c4d",
  "homepage": "https://github.com/ampproject/amp-toolbox/tree/master/packages/optimizer",
  "keywords": [
    "amp"
  ],
  "license": "Apache-2.0",
  "main": "index.js",
  "maintainers": [
    {
      "name": "amp-toolbox",
      "email": "amp-toolbox-eng@google.com"
    }
  ],
  "name": "amp-toolbox-optimizer",
  "optionalDependencies": {},
  "peerDependenciesMeta": {
    "jimp": {
      "optional": true
    },
    "lru-cache": {
      "optional": true
    }
  },
  "readme": "# AMP Optimizer\n\n[![npm version](https://badge.fury.io/js/amp-toolbox-optimizer.svg)](https://badge.fury.io/js/amp-toolbox-optimizer)\n\nAMP Optimizer - the performance optimizations of the AMP Cache on your own site.\n\n![AMP Optimizer in Action](https://user-images.githubusercontent.com/380472/36001450-96cfbce2-0d26-11e8-8b65-4ffc3182d57c.gif)\n\nFirst Render - 3.0 seconds vs 4.8 seconds (37% faster) <br>\nVisually Complete - 3.7 seconds vs 6.4 seconds (42% faster) <br>\n\nwww.ampproject.org\n\n## Introduction\n\nAMP Optimizer optimizes AMPHTML files by: \n\n* Server-side rendering AMP layouts.\n* Removing the AMP boilerplate.\n* Pre-loading the AMP `v0.js` runtime to benefit from H2 push.\n* Versioning AMP runtime and extension imports.\n* Inlining critical CSS.\n\nYou can find the currently supported transformations [here](lib/transformers).\n\n**Warning: optimized AMPs will no longer be valid AMPHTML. Don't use this to optimize AMPs meant for being used by platforms such as Google Search.**\n\n## Table of Contents\n\n- [Introduction](#introduction)\n- [Background](#background)\n- [Usage](#usage)\n  - [Options](#options)\n  - [Versioned AMP Runtime](##versioned-amp-runtime)\n- [Example](#example)\n- [Best Practices](#best-practices)\n  - [Transform AMP pages at build time if possible](#transform-amp-pages-at-build-time-if-possible)\n  - [Cache transformed AMPs](#cache-transformed-amps)\n- [Why is it faster?](#why-is-it-faster)\n- [Caveats](#caveats)\n- [Version History](#version-history)\n\n## Background\n\nThe [Google AMP Cache](https://developers.google.com/amp/cache/overview#cache-optimizations-and-modifications) performs additional optimizations to make AMP pages load even faster. You can find out more about these optimizations [here](https://github.com/ampproject/amphtml/issues/7022) and [here](https://github.com/ampproject/amphtml/issues/8566). This project provides a Node.js based implementation of the same set of transformations performed by the Google AMP Cache. This serves two goals:\n\n* Enable faster loading times for canonical AMP sites.\n* Provide a reference implementation for other AMP caches.\n\n## Usage\n\nInstall via:\n\n```\nnpm install amp-toolbox-optimizer\n```\n\nMinimal usage:\n\n```js\nconst ampOptimizer = require('amp-toolbox-optimizer');\n\n// Transformer expects a string (streams are not supported)\nconst originalHtml = `\n<!doctype html>\n<html ⚡>\n...\n`\n\n// Additional options can be passed as the second argument\nampOptimizer.transformHtml(originalHtml, {\n  ampUrl: 'canonical.amp.html'\n}).then(optimizedHtml => {\n  console.log(optimizedHtml);\n});\n\n```\n\nYou can find a sample implementation [here](demo/simple/). If you're using the express middleware in your backend, it's best to use the [AMP Optimizer Middleware](../optimizer-express).\n\n### Options\n\nCurrently the following options are supported:\n\n* **ampUrl**: an URL string pointing to the valid AMP version. Required by the AddAmpLink transformer.\n* **blurredPlaceholders**: enables blurry image placeholder generation. Default is `false`. This transforms requires install `jimp` and `lru-cache`: `npm install jimp lru-cache` **Important:** blurry image placeholder computation is expensive. Make sure to only use it for static or cached pages.\n* **imageBasePath**: a base URL or path required for resolving an image file from a given image `src` attribute. Used by for blurry image placeholder generation.\n* **maxBlurredPlaceholders**: specifies the max number of blurred images. Defaults to 5.\n* **ampRuntimeVersion** specifies a [specific version](https://github.com/ampproject/amp-toolbox/tree/master/runtime-version\") of the AMP runtime. For example: `ampRuntimeVersion: \"001515617716922\"` will result in AMP runtime URLs being re-written from:\n\n  ```\n  https://cdn.ampproject.org/v0.js\n  ```\n\n  to:\n\n  ```\n  https://cdn.ampproject.org/rtv/001515617716922/v0.js\n  ```\n* **ampUrlPrefix (experimental)**: specifies an URL prefix for AMP runtime\n  URLs. For example: ```ampUrlPrefix: \"/amp\"` will result in AMP runtime\n  URLs being re-written from:\n\n  ```\n  https://cdn.ampproject.org/v0.js\n  ```\n\n  to:\n\n  ```\n  /amp/v0.js\n  ```\n\n### Versioned AMP Runtime\n\nThe `ampRuntimeVersion` parameter will rewrite all AMP runtime and extension imports to the specified version. For example: \n\n```\nhttps://cdn.ampproject.org/v0.js\n```\n\nwill be replaced with:\n\n```\nhttps://cdn.ampproject.org/rtv/001515617716922/v0.js\n```\n\nVersioning the AMP runtime URLs has two benefits:\n\n1. Better usage of the brower cache: versioned AMP runtime URLs are served with a longer max-age than the unversioned ones.\n2. Critical CSS can be inlined. The AMP runtime defines it's [own CSS styles](https://cdn.ampproject.org/v0.css) for AMP layouts and other things. Versioning the AMP runtime makes it possible to inline these styles, which greatly improving time to FCP as it ensures that inlined styles and imported runtime are compatible.\n\n**Important:** when using versioned AMP runtime URLs make sure to invalidate all caches whenever a new AMP runtime is released. This is to ensure that your AMP pages always use the latest version of the AMP runtime.  \n\nYou can use [amp-toolbox-runtime-version](../amp-toolbox-runtime-version) to retrieve the latest version of the AMP runtime. Here is a sample to apply the optimizations including versioning the URLs:\n\n```\nconst ampOptimiser = require('amp-toolbox-optimizer');\n\n// retrieve the latest runtime version\nconst runtimeVersion = require('amp-toolbox-runtime-version');\n\n// retrieve the latest version\nconst ampRuntimeVersion = await runtimeVersion.currentVersion();\n\n// The input string\nconst originalHtml = `\n<!doctype html>\n<html ⚡>\n...\n`\n\n// Additional options can be passed as the second argument\nconst optimizedHtml = await ampOptimizer.transformHtml(originalHtml, {\n  ampUrl: 'canonical.amp.html',\n  ampRuntimeVersion: ampRuntimeVersion\n});\n\nconsole.log(optimizedHtml);\n```\n\n## Example\n\nThe following valid AMPHTML:\n\n```html\n<!doctype html>\n<html ⚡>\n<head>\n  <meta charset=\"utf-8\">\n  <link rel=\"canonical\" href=\"canonical.html\" />\n  <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1\">\n  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n  <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n  <script async custom-element=\"amp-experiment\" src=\"https://cdn.ampproject.org/v0/amp-experiment-0.1.js\"></script>\n  <script async custom-template=\"amp-mustache\" src=\"https://cdn.ampproject.org/v0/amp-mustache-0.1.js\"></script>\n  <style amp-custom>\n    h1 {\n      margin: 16px;\n    }\n  </style>\n</head>\n<body>\n  <h1>Hello, AMP world!</h1>\n  <amp-img width=360 heigh=200 layout=responsive src=image.png></amp-img>\n</body>\n</html>\n```\n\nWill be transformed to:\n\n```html\n<!DOCTYPE html>\n<html i-amphtml-layout=\"\" i-amphtml-no-boilerplate=\"\">\n<head>\n  <style amp-runtime=\"\"></style>\n  <link rel=\"stylesheet\" href=\"https://cdn.ampproject.org/v0.css\">\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1\">\n  <script async=\"\" src=\"https://cdn.ampproject.org/v0.js\"></script>\n  <script async=\"\" custom-element=\"amp-experiment\" src=\"https://cdn.ampproject.org/v0/amp-experiment-0.1.js\"></script>\n  <script async=\"\" custom-template=\"amp-mustache\" src=\"https://cdn.ampproject.org/v0/amp-mustache-0.1.js\"></script>\n  <style amp-custom=\"\">\n    h1 {\n      margin: 16px;\n    }\n  </style>\n  <link rel=\"canonical\" href=\"canonical.html\">\n  <link rel=\"amphtml\" href=\"canonical.amp.html\">\n</head>\n<body>\n  <h1>Hello, AMP world!</h1>\n  <amp-img width=\"360\" heigh=\"200\" layout=\"responsive\" src=\"image.png\" class=\"i-amphtml-layout-responsive i-amphtml-layout-size-defined\" i-amphtml-layout=\"responsive\"></amp-img>\n</body>\n</html>\n```\n\nA few notable changes are:\n\n* The AMP attribute in the `html` tag gets removed as it's no longer valid AMP.\n* The AMP boilerplate gets removed. Instead the `v0.css` is added.\n* AMP layout classes are added to the `amp-img` extension.\n* `<link rel=\"amphtml\" href=\"canonical.amp.html\">` gets added linking to the valid AMP version.\n\n## Best Practices\n\n### Debugging\n\nEnable `verbose` mode to find out why the AMP boilerplate is not being removed.\n\n```\n// globally\nampOptimizer.setConfig({\n  verbose: true\n});\nampOptimizer.transformHtml(originalHtml, {\n  ampUrl: 'canonical.amp.html'\n})\n\n// per transformation\nampOptimizer.transformHtml(originalHtml, {\n  ampUrl: 'canonical.amp.html',\n  verbose: true\n})\n```\n\n### Transform AMP pages at build time if possible\n\nApplying the transformations to an AMP file consumes additional server\nresources. Also, since the entire file is needed to apply the transformations,\nit also becomes impossible to stream the response while applying it.\n\nIn order to avoid server overhead, if the set of AMP files to be transformed is\nknown in advance, transformations should be run at build time.\n\n### Cache transformed AMPs\n\nMost websites have a more dynamic nature though and are not able to apply the\ntransformations statically. For such cases it is possible to run the\ntransformations after AMP pages are rendered, e.g. in an Express middleware.\n\nTo achieve best performance, those transformations shouldn't be applied for\nevery request. Instead, transformations should only be applied the *first time*\na page is requested, and the results then cached. Caching can happen on the CDN\nlevel, on the site's internal infrastructure (eg: Memcached), or even on the\nserver itself, if the set of pages is small enough to fit in memory.\n\n## Why is it faster?\n\nIn order to avoid Flash of Unstyled Content (FOUC) and reflows resulting from to the\nusage of web-components, AMP requires websites to add the amp-boilerplate in the header.\n\nThe amp-boilerplate renders the page invisible by changing it's opacity, while\nthe fonts and the AMP Runtime load. Once the AMP runtime is loaded, it is able\nto correctly set the sizes of the custom elements and once that happens, the\nruntimes makes the page visible again.\n\nAs a consequence, the first render of the page doesn't happen until the AMP\nRuntime is loaded.\n\nTo improve this, AMP server-side rendering applies the same rules as the\nAMP Runtime on the server. This ensures that the reflow will not happen  and\nthe AMP boilerplate is no longer needed. The first render no longer depends on the\nAMP Runtime being loaded, which improves load times.\n\n## Caveats\n\nIt's important to note that, even though the text content and layout will show\nfaster, content that depends on the custom AMP elements (eg: any element in\nthe page that starts with 'amp-') will only be visible after the AMP Runtime\nis loaded.\n\n",
  "readmeFilename": "README.md",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/ampproject/amp-toolbox.git"
  },
  "version": "0.5.2-beta.6"
}
